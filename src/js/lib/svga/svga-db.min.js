/*!
 * @project : svga-web-canvas
 * @version : 0.0.1
 * @author  : UED.lijialiang
 * @update  : 2016-10-21 9:35:38 am
 * @email   : lijialiang@yy.com
 */!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SvgaDb=t():e.SvgaDb=t()}(this,function(){return function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a,r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();e.exports=(r=a=function(){function e(t){n(this,e),this._initDB(),this._createTable()}return o(e,[{key:"_initDB",value:function(){e.db=openDatabase("legox","1.0","LegoX DB",5242880)}},{key:"_errorCallBack",value:function(e,t){console.error("[Svga Web Canvas DB]: ",t)}},{key:"_createTable",value:function(){e.tableAttributeString="",e.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.table.name+" ("+e.table.attribute+")")})}},{key:"add",value:function(t){var n=this,a=t.url,r=t.movie,o=t.images;e.db.transaction(function(t){t.executeSql("INSERT INTO "+e.table.name+" ("+e.table.attribute+") VALUES (?, ?, ?, ?)",[a,JSON.stringify(r),JSON.stringify(o),new Date],function(e,t){console.info("[Svga Web Canvas DB]: add success")},n._errorCallBack)})}},{key:"find",value:function(t,n){var a=this;e.db.transaction(function(r){r.executeSql("SELECT * FROM "+e.table.name+" WHERE url LIKE ?",[t],function(e,t){t.rows.length>0?n(JSON.parse(t.rows.item(0).images),JSON.parse(t.rows.item(0).movie),!1):n("","",!0)},a._errorCallBack)})}},{key:"clear",value:function(e){"string"==typeof e?this._clearByUrl(e):"number"==typeof e&&this._clearByDate(e)}},{key:"_clearByUrl",value:function(t){var n=this;e.db.transaction(function(a){a.executeSql("DELETE FROM "+e.table.name+" WHERE url LIKE ?",[t],function(e,t){console.info("[Svga Web Canvas DB]: clear success")},n._errorCallBack)})}},{key:"_clearByDate",value:function(t){var n=this,a=new Date;e.db.transaction(function(r){r.executeSql("SELECT * FROM "+e.table.name,[],function(e,r){for(var o=r.rows.length,i=0;i<o;i++){var c=r.rows.item(i),l=new Date(c.time),u=(a.getTime()-l.getTime())/864e5;u>=t&&n._clearByUrl(c.url)}},n._errorCallBack)})}}]),e}(),a.table={name:"svga",attribute:"url, movie, images, time"},r)}])});